---
import { Footer, Header, ThemeProvider } from 'astro-pure/components/basic'
import type { SiteMeta } from 'astro-pure/types'
import BaseHead from '@/components/BaseHead.astro'
import config from '@/site-config'

// Import the global.css file here so that it is included on
// all pages through the use of the <BaseLayout /> component.
import '@/assets/styles/global.css'
import '@/assets/styles/app.css'

interface Props {
  meta: SiteMeta
  highlightColor?: string
}

const {
  meta: { articleDate, description = config.description, ogImage, title },
  highlightColor,
  ...props
} = Astro.props
---

<html lang={config.locale.lang}>
  <head>
    <BaseHead {articleDate} {description} {ogImage} {title} />
    <ThemeProvider />
  </head>

  <body class='flex justify-center bg-background text-foreground' {...props}>
    {
      highlightColor && (
        <div
          id='highlight-gradient'
          class='pointer-events-none absolute start-0 top-0 z-0 h-screen w-full opacity-25'
          style={`background-image:linear-gradient(${highlightColor},transparent)`}
        />
      )
    }
    <div
      class='w-full max-w-[70rem] px-4 sm:px-7 lg:px-10 min-h-[100dvh] flex flex-col justify-between'
    >
      <Header />
      <div class='flex-1 w-full'>
        <slot />
      </div>
      <Footer />
    </div>

    {/* Set highlight color */}
    <style define:vars={{ highlightColor }}>
      :global(.highlight) {
        --highlight-fg: color-mix(
          in srgb,
          var(--highlightColor) 40%,
          hsl(var(--foreground)/var(--un-text-opacity, 1))
        );
        color: var(--highlight-fg, hsl(var(--primary) / var(--un-text-opacity))) !important;
      }
      :global(.highlight-bg) {
        background-color: var(
          --highlightColor,
          hsl(var(--primary) / var(--un-text-opacity))
        ) !important;
      }

       /* 基础粒子样式 */
      :global(.click-particle) {
        position: fixed;
        top: 0;
        left: 0;
        pointer-events: none;
        z-index: 99999;
        border-radius: 50%;
        /* 时间从0.8s延长到1.2s，动作更舒展 */
        animation: particle-pop 1.2s cubic-bezier(0.25, 1, 0.5, 1) forwards;
      }

      /* 动画关键帧：弹跳 -> 悬停 -> 下落 */
      @keyframes particle-pop {
        0% {
          opacity: 1;
          /* 初始很小，在这个位置 */
          transform: translate(var(--x), var(--y)) scale(0.3);
        }
        15% {
          opacity: 1;
          /* 快速变大并冲到目标位置 (爆裂感) */
          transform: translate(calc(var(--x) + var(--dx)), calc(var(--y) + var(--dy))) scale(1.2);
        }
        25% {
          opacity: 1;
          /* 稍微悬停一下，维持大小 */
          transform: translate(calc(var(--x) + var(--dx) * 1.01), calc(var(--y) + var(--dy) * 1.01)) scale(1);
        }
        100% {
          opacity: 0;
          /* 慢慢下落、旋转、变小消失 */
          transform: translate(calc(var(--x) + var(--dx) * 1.3), calc(var(--y) + var(--dy) + 80px)) scale(0) rotate(var(--r));
        }
      }

      /* 颜色：保持你喜欢的随机 HSL，亮色更粉嫩 */
      :global(.click-particle) {
        background: hsl(var(--hue), 90%, 75%);
        box-shadow: 0 0 6px hsl(var(--hue), 90%, 75%, 0.8);
      }

      :global(.dark .click-particle) {
        background: hsl(var(--hue), 80%, 65%);
        box-shadow: 0 0 8px hsl(var(--hue), 80%, 65%, 0.6);
      }
    </style>

    <script>
      (function () {
        function createParticle(x, y, angle, distance, delay) {
          setTimeout(() => {
            const particle = document.createElement('div');
            particle.className = 'click-particle';

            // 随机颜色
            const hue = Math.floor(Math.random() * 360);
            // 随机大小 (稍微调大一点点，更显眼)
            const size = Math.random() * 5 + 7; 

            // 计算爆发坐标
            const dx = Math.cos(angle) * distance;
            const dy = Math.sin(angle) * distance;
            
            // 随机旋转
            const r = Math.random() * 360 + 'deg';

            particle.style.setProperty('--x', x + 'px');
            particle.style.setProperty('--y', y + 'px');
            particle.style.setProperty('--dx', dx + 'px');
            particle.style.setProperty('--dy', dy + 'px');
            particle.style.setProperty('--r', r);
            particle.style.setProperty('--hue', hue.toString());
            
            particle.style.width = size + 'px';
            particle.style.height = size + 'px';

            document.body.appendChild(particle);

            setTimeout(() => {
              particle.remove();
            }, 1200); // 对应 CSS 的 1.2s
          }, delay);
        }

        document.addEventListener('click', (e) => {
          // 1. 核心圆环：12个粒子，均匀分布成一个圆，找回“集中感”
          const particleCount = 10;
          const baseDistance = 40; // 爆发半径
          
          for (let i = 0; i < particleCount; i++) {
            // 严格的圆形分布
            const angle = (Math.PI * 2 / particleCount) * i;
            const distance = baseDistance + Math.random() * 5; // 轻微浮动
            // 稍微错开一点时间，产生“波纹”感
            createParticle(e.clientX, e.clientY, angle, distance, i * 10);
          }

          // 2. 随机填充：8个粒子，随机散落在周围，增加丰富度
          for (let i = 0; i < 8; i++) {
            const angle = Math.random() * Math.PI * 2;
            const distance = baseDistance + Math.random() * 20;
            createParticle(e.clientX, e.clientY, angle, distance, i * 15);
          }
        });
      })();
    </script>

  </body>
</html>
